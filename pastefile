
private async Task<byte[]> ObjectToByteArrayAsync(object obj)
{
    using (var memoryStream = new MemoryStream())
    {
        using (var writer = new StreamWriter(memoryStream))
        {
            var jsonText = JsonConvert.SerializeObject(obj);
            await writer.WriteAsync(jsonText);
            await writer.FlushAsync();
        }
        return memoryStream.ToArray();
    }
}
