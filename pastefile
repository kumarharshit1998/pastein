using System;
using System.DirectoryServices.AccountManagement;

protected void btnLogin_Click(object sender, EventArgs e)
{
    string domain = "bbtnet.com"; // Replace with your domain name
    string username = txtUsername.Text;
    string password = txtPassword.Text;
    string adGroup = "YourADGroupName"; // Replace with the desired AD group name

    if (ValidateUser(domain, username, password) && IsUserInGroup(domain, username, adGroup))
    {
        // Redirect to another page on successful login
        Response.Redirect("Admin.aspx"); // Replace with your target page
    }
    else
    {
        // Show error message
        lblMessage.Text = "Invalid username, password, or user is not in the required AD group.";
    }
}

static bool ValidateUser(string domain, string username, string password)
{
    using (var context = new PrincipalContext(ContextType.Domain, domain))
    {
        return context.ValidateCredentials(username, password, ContextOptions.Negotiate);
    }
}

static bool IsUserInGroup(string domain, string username, string groupName)
{
    using (var context = new PrincipalContext(ContextType.Domain, domain))
    using (var user = UserPrincipal.FindByIdentity(context, username))
    using (var group = GroupPrincipal.FindByIdentity(context, groupName))
    {
        if (user != null && group != null)
        {
            return user.IsMemberOf(group);
        }
        return false;
    }
}
