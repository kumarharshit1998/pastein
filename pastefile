using CIFSearch;
using System;
using System.Net.Http;
using System.Security.Cryptography.X509Certificates;
using System.ServiceModel;
using System.Threading.Tasks;

namespace LossMitigationMVC.Services
{
    public class CIFSoapClientService
    {
        private readonly ClientSearchAPIClient _client;

        public CIFSoapClientService()
        {
            // Load certificate
            var certificate = new X509Certificate2("your_cert.pfx", "your_password");

            // Set up binding
            var binding = new BasicHttpsBinding
            {
                Security = new BasicHttpsSecurity
                {
                    Mode = BasicHttpsSecurityMode.Transport
                }
            };

            // Define the API endpoint
            var endpoint = new EndpointAddress("https://api-lms-ite.eapi02-mt.truist-tst.com/clientsearchapi-01-eapi02-ite/clientsearchapi");

            // Initialize client
            _client = new ClientSearchAPIClient(binding, endpoint);

            // Attach the certificate for authentication
            _client.ClientCredentials.ClientCertificate.Certificate = certificate;
        }

        public async Task<ClientSearchReply> SearchClientAsync(string accountNumber)
        {
            var request = new ClientSearchRequest
            {
                ClientSearchType = "A",
                AccountSearch = new AccountSearch
                {
                    AccountNumber = accountNumber
                }
            };

            return await _client.ClientSearchAsync(request);
        }
    }
}
